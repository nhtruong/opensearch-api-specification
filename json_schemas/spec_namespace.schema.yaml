$schema: https://json-schema.org/draft/2020-12/schema

description: Schema for files in the spec/namespaces directory.

type: object
additionalProperties: false
properties:
  $schema:
    const: ../../json_schemas/spec_namespace.schema.yaml
  openapi:
    const: 3.1.0
  paths:
    $ref: '#/$defs/paths'
  components:
    $ref: '#/$defs/components'
required:
  - $schema
  - openapi
  - paths
  - components

$defs:
  reference:
    type: object
    properties:
      $ref:
        type: string
        format: uri-reference
      description:
        type: string
      title:
        type: string
    required: [ $ref ]
    additionalProperties: false

  schema:
    $ref: https://json-schema.org/draft/2020-12/schema

  versioning-extensions:
    type: object
    properties:
      x-version-added:
        description: OpenSearch version when the operation/parameter was added.
        type: string
      x-version-deprecated:
        description: OpenSearch version when the operation/parameter was deprecated.
        type: string
      x-version-removed:
        description: OpenSearch version when the operation/parameter was removed.
        type: string
      x-deprecation-message:
        description: Reason for deprecation and guidance on how to prepare for the next major version.
        type: string

  distribution-extensions:
    type: object
    properties:
      x-distributions-included:
        description: Contains a list of distributions known to include the API.
        $ref: '#/$defs/distributions'
      x-distributions-excluded:
        description: Contains a list of distributions known to exclude the API.
        $ref: '#/$defs/distributions'

  distributions:
    type: array
    items:
      type: string
      enum: [ opensearch.org, amazon-managed, amazon-serverless ]

  paths:
    type: object
    propertyNames:
      pattern: '^/'
    additionalProperties:
      $ref: '#/$defs/path-item'

  path-item:
    type: object
    properties:
      get:
        $ref: '#/$defs/operation'
      put:
        $ref: '#/$defs/operation'
      post:
        $ref: '#/$defs/operation'
      delete:
        $ref: '#/$defs/operation'
      options:
        $ref: '#/$defs/operation'
      head:
        $ref: '#/$defs/operation'
      patch:
        $ref: '#/$defs/operation'
      trace:
        $ref: '#/$defs/operation'
    additionalProperties: false

  operation:
    type: object
    properties:
      description:
        type: string
      externalDocs:
        $ref: '#/$defs/external-documentation'
      operationId:
        type: string
      x-operation-group:
        description: Used to group operations into API actions.
        type: string
      x-ignorable:
        description: Denotes that the operation should be ignored by the client generator. 
          This is used in operation groups where some operations have been replaced by newer ones, 
          but we still keep them in the specs because the server still supports them.
        type: boolean
      parameters:
        type: array
        items:
          $ref: '#/$defs/reference'
      requestBody:
        $ref: '#/$defs/reference'
      responses:
        $ref: '#/$defs/responses'
      deprecated:
        default: false
        type: boolean
    required:
      - description
      - externalDocs
      - operationId
      - responses
      - parameters
      - x-operation-group
    allOf:
      - $ref: '#/$defs/versioning-extensions'
      - $ref: '#/$defs/distribution-extensions'
    unevaluatedProperties: true

  external-documentation:
    type: object
    properties:
      description:
        type: string
      url:
        type: string
        format: uri
    required:
      - url
    unevaluatedProperties: false

  responses:
    type: object
    propertyNames:
      pattern: '^[1-5](?:[0-9]{2}|XX)$'
    additionalProperties:
      $ref: '#/$defs/reference'
    minProperties: 1

  components:
    properties:
      parameters:
        type: object
        additionalProperties:
          $ref: '#/$defs/parameter'
      responses:
        type: object
        additionalProperties:
          $ref: '#/$defs/response'
      requestBodies:
        type: object
        additionalProperties:
          $ref: '#/$defs/request-body'

  parameter:
    type: object
    properties:
      name:
        type: string
      in:
        enum:
          - query
          - path
      description:
        type: string
      required:
        default: false
        type: boolean
      deprecated:
        default: false
        type: boolean
      schema:
        $ref: '#/$defs/schema'
      x-global:
        description: Denotes that the parameter is a global parameter that is included in every operation
        type: boolean
        default: false
      x-default:
        description:  Contains the default value of a parameter. 
          This is often used to override the default value specified in the schema, 
          or to avoid accidentally changing the default value when updating a shared schema.
        type: [string, number, boolean]
    required:
      - name
      - in
      - schema
      - description
    additionalProperties: false

  response:
    type: object
    properties:
      description:
        type: string
      content:
        $ref: '#/$defs/content'
    required:
      - content
    additionalProperties: false

  request-body:
    type: object
    properties:
      description:
        type: string
      content:
        $ref: '#/$defs/content'
      required:
        default: false
        type: boolean
    required:
      - content
    additionalProperties: false

  content:
    type: object
    additionalProperties:
      $ref: '#/$defs/media-type'
    propertyNames:
      format: media-range

  media-type:
    type: object
    properties:
      schema:
        $ref: '#/$defs/schema'
#      examples: # We will most likely generate examples from test stories. Remove this once we know for sure.
#        type: object
#        additionalProperties:
#          $ref: '#/$defs/example'
    required: [ schema ]
    unevaluatedProperties: false

#  example: # We will most likely generate examples from test stories. Remove this once we know for sure.
#    type: object
#    properties:
#      description:
#        type: string
#      value: true
#      externalValue:
#        type: string
#        format: uri
#    unevaluatedProperties: false
